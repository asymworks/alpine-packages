# Contributor: Jonathan Krauss <jkrauss@asymworks.com>
# Maintainer: Jonathan Krauss <jkrauss@asymworks.com>
pkgname=acme-dns
pkgver=1.1
pkgrel=0
pkgdesc="Limited DNS server with RESTful HTTP API to handle ACME DNS challenges easily and securely."
url="https://github.com/joohoi/acme-dns"
arch="x86_64 aarch64 armhf armv7"
license="MIT"
makedepends="go binutils-gold"
checkdepends=""
options="net !check" # disable checks because they require a running Docker daemon
subpackages="$pkgname-openrc"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/joohoi/acme-dns/archive/refs/tags/v$pkgver.tar.gz
	acme-dns.confd
	acme-dns.initd
"

build() {
	go mod tidy

	export CGO_ENABLED=1
	export GOOS=linux
	go build .
}

package() {
	install -Dm755 "$builddir"/acme-dns "$pkgdir"/usr/bin/acme-dns
	install -Dm644 "$builddir"/config.cfg "$pkgdir"/etc/acme-dns/config.cfg

	install -Dm644 "$srcdir"/acme-dns.confd "$pkgdir"/etc/conf.d/acme-dns
	install -Dm755 "$srcdir"/acme-dns.initd "$pkgdir"/etc/init.d/acme-dns
}

sha512sums="
fa314d7a8c21240780ded8901add6dfed97f8e0c0be1c95cdbf06c68e8a3a2f7afe944024435c1ed19bac9f054b97a3293df8e5a7accbd368a8753a7113d0989  acme-dns-1.1.tar.gz
87ea3e2bf1a2d73713815dbcdc0ca6062f43ea1cc61d13b5138311fcb5dabd1b8ba35ad0f25d2ee5236f4d16cbd14cd8ae0347c973a60225a8a6e8b82c97f92e  acme-dns.confd
6de18d15678f87fc230572515e7e8c9e97b1f58852864bfe0ecbb9a3ed8bc9c92231baa486d31d9db8b153b7b9c71b4b23b9394ecc6728665eb8ebed0cd62d1b  acme-dns.initd
"
