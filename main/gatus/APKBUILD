# Contributor: Jonathan Krauss <jkrauss@asymworks.com>
# Maintainer: Jonathan Krauss <jkrauss@asymworks.com>
pkgname=gatus
pkgver=5.26.0
pkgrel=1
pkgdesc="Automated developer-oriented status page"
url="https://github.com/TwiN/gatus"
arch="x86_64 aarch64 armhf armv7"
license="Apache-2.0"
makedepends="go binutils-gold"
checkdepends=""
options="net !check" # disable checks because they require a running Docker daemon
subpackages="$pkgname-openrc"
source="
	$pkgname-$pkgver.tar.gz::https://github.com/TwiN/gatus/archive/refs/tags/v$pkgver.tar.gz
	00-default.yaml
	gatus.confd
	gatus.initd
	logrotate
"

build() {
	go mod tidy

	export CGO_ENABLED=0
	export GOOS=linux
	export GOFLAGS="-a -installsuffix=cgo -o=gatus"

	go build .
}

package() {
	install -Dm755 "$builddir"/gatus "$pkgdir"/usr/bin/gatus
	install -Dm644 "$srcdir"/00-default.yaml "$pkgdir"/etc/gatus.d/00-default.yaml
	install -Dm644 "$srcdir"/logrotate "$pkgdir"/etc/logrotate.d/gatus

	install -Dm644 "$srcdir"/gatus.confd "$pkgdir"/etc/conf.d/gatus
	install -Dm755 "$srcdir"/gatus.initd "$pkgdir"/etc/init.d/gatus
}

sha512sums="
f064f6cd48b4f3c90cccadf18215369bf0b73dd1376d8083335778d59165b1a25309a9701bcf6fc251ab2144924e7fb1b81eba766399ac936814659a5d802d90  gatus-5.26.0.tar.gz
19324bddf88a5d91a0f2d4dcc21a3c5d796ef5323c0568b61e4f9517da724021b57aec43d2c652cc40c61d26f000f214034ee23ebc6a07445203fe23b0f8209b  00-default.yaml
b15ab0129b8c89e771482453ab07b274601339c3aa69a8ed561f668e3553079c22ebaff6ad7af6737835aca59fcb1940a44d43e7d856696d2731400d96720c45  gatus.confd
05873b705be1d10d9422e508adb3b9c161686f5c83f0edd7216377bb679e0281c7834eb63983c357443c2bf23523bd1f528bd1869f5474f7b1b955ec25021f56  gatus.initd
e9566fa3950c3c88130d8edf5d34f4b46d37f6dccc7bccbb8aa4f23a39c00247c40f1be8ea396aade24df9e8a9014b76e56172fadd7e0f7c9891e4a41910194c  logrotate
"
